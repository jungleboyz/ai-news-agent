{% extends "base.html" %}

{% block title %}Topics - AI News Agent{% endblock %}

{% block content %}
<div class="space-y-8">
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
            <h1 class="text-3xl font-bold text-slate-50">Topics</h1>
            <p class="text-slate-400 mt-1">AI news grouped by theme</p>
        </div>

        <!-- Date filter -->
        <form method="get">
            <select name="digest_date"
                    class="px-4 py-2 bg-slate-800 text-slate-100 rounded-lg border border-slate-700 focus:border-emerald-500 focus:outline-none"
                    onchange="this.form.submit()">
                <option value="">All dates</option>
                {% for d in available_dates %}
                <option value="{{ d }}" {% if selected_date == d|string %}selected{% endif %}>
                    {{ d }}
                </option>
                {% endfor %}
            </select>
        </form>
    </header>

    {% if clusters %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for cluster_data in clusters %}
        {% set cluster = cluster_data.cluster %}
        {% set items = cluster_data.items %}
        <div class="rounded-xl p-6 border border-slate-800 bg-slate-900/70 hover:border-slate-700 transition-all group">
            <div class="flex items-start justify-between mb-4">
                <h2 class="text-lg font-semibold text-slate-50 group-hover:text-emerald-400 transition-colors">{{ cluster.label }}</h2>
                <span class="flex-shrink-0 ml-2 px-2.5 py-0.5 text-xs font-semibold rounded-full bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">
                    {{ cluster.item_count }}
                </span>
            </div>

            {% if cluster.summary %}
            <p class="text-slate-400 text-sm mb-4 line-clamp-2">{{ cluster.summary }}</p>
            {% endif %}

            {% if cluster.avg_score %}
            <div class="flex items-center gap-2 mb-4">
                <span class="text-xs text-slate-500">Avg score:</span>
                <span class="px-2 py-0.5 text-xs font-mono rounded
                    {% if cluster.avg_score >= 5 %}bg-emerald-500/20 text-emerald-300
                    {% else %}bg-slate-800 text-slate-400{% endif %}">
                    {{ "%.1f"|format(cluster.avg_score) }}
                </span>
            </div>
            {% endif %}

            <div class="space-y-2 mb-4">
                {% for item in items %}
                <a href="{{ item.link }}" target="_blank"
                   class="flex items-start gap-2 text-sm text-slate-300 hover:text-emerald-400 transition-colors">
                    {% if item.type == 'news' %}
                    <span class="flex-shrink-0 mt-0.5 text-xs">&#x1F4F0;</span>
                    {% else %}
                    <span class="flex-shrink-0 mt-0.5 text-xs">&#x1F399;&#xFE0F;</span>
                    {% endif %}
                    <span class="line-clamp-1">{{ item.title }}</span>
                </a>
                {% endfor %}
                {% if cluster.item_count > 3 %}
                <span class="text-slate-500 text-xs pl-5">+ {{ cluster.item_count - 3 }} more</span>
                {% endif %}
            </div>

            <div class="flex items-center justify-between text-sm pt-3 border-t border-slate-800">
                <span class="text-slate-500 text-xs">
                    {% if cluster_data.digest_date %}
                    {{ cluster_data.digest_date }}
                    {% endif %}
                </span>
                <a href="/topics/{{ cluster.cluster_id }}"
                   class="text-emerald-400 hover:text-emerald-300 text-xs font-medium">
                    View all &rarr;
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-16">
        <svg class="w-16 h-16 mx-auto text-slate-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
        </svg>
        <p class="text-slate-400 text-lg mb-2">No topics found</p>
        <p class="text-slate-500 text-sm">Topics are generated automatically when digests run with clustering enabled.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
